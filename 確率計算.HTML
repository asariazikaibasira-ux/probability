<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>確率計算</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', 'Yu Gothic', 'Meiryo', sans-serif; background:#f7f7fa; color:#222; margin:0; }
    .container { max-width: 800px; margin: 32px auto; padding: 0 16px; }
    h1 { font-size: 2rem; margin: 0 0 12px; color:#2c3e50; text-align:center; }
    p.note { text-align:center; color:#555; margin: 0 0 24px; }
    .card { background:#fff; box-shadow:0 2px 8px rgba(44,62,80,0.08); border-radius:8px; padding:16px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .field { display:flex; flex-direction:column; }
    label { font-weight:700; margin-bottom:6px; color:#34495e; }
    input[type="number"] { font-size:1.1rem; padding:10px; border:1px solid #bbb; border-radius:6px; }
    .actions { margin-top: 12px; display:flex; gap:8px; }
    button { font-size:1.1rem; padding:10px 16px; border:none; border-radius:6px; cursor:pointer; background:#2c3e50; color:#fff; }
    .secondary { background:#7f8c8d; }
    .error { color:#c0392b; font-weight:700; margin-top:8px; }
    .result { margin-top:16px; font-weight:700; color:#2c3e50; }
    .result .big { font-size:1.4rem; color:#27ae60; }
    .muted { color:#666; font-size:0.95rem; }
    /* N入力用の大型スピンボタン */
    .spin-group { display:flex; align-items:center; gap:10px; }
    .spin-buttons { display:flex; flex-direction:column; gap:8px; }
    .spin-buttons button { width:44px; height:44px; font-size:1.2rem; padding:0; }
    @media (max-width:640px) {
      .grid { grid-template-columns: 1fr; }
      .actions { flex-direction: column; }
      .actions button { width: 100%; min-height: 44px; }
      input[type="number"], input[type="text"] { width: 100%; }
      .spin-group { gap: 8px; }
      .spin-buttons { flex-direction: row; }
      .result .big { font-size: 1.6rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>確率計算</h1>
    <p class="note">単回発生確率 <b>p</b> と試行回数 <b>N</b> を入力すると、少なくとも1回発生する確率を計算します。</p>

    <div class="card">
      <div class="grid">
        <div class="field">
          <label for="pInput">発生確率 p（0〜1 ／ % ／ 1/分母）</label>
          <input type="text" id="pInput" inputmode="decimal" placeholder="例: 0.1 ／ 10 ／ 10% ／ 1/100">
          <span class="muted">0.1 は 10% を意味します。分数（例: 1/100）や 10% 入力にも対応します。</span>
        </div>
        <div class="field">
          <label for="nInput">試行回数 N（0以上の整数）</label>
          <div class="spin-group">
            <input type="number" id="nInput" inputmode="numeric" step="1" min="0" placeholder="例: 10">
            <div class="spin-buttons">
              <button id="nUp" aria-label="Nを増やす">▲</button>
              <button id="nDown" aria-label="Nを減らす">▼</button>
            </div>
          </div>
        </div>
      </div>
      <div class="actions">
        <button id="calcBtn">計算</button>
        <button id="resetBtn" class="secondary">全体リセット</button>
        <button id="resetNBtn" class="secondary">試行回数リセット</button>
      </div>
      <div id="error" class="error" aria-live="polite"></div>
      <div id="result" class="result" aria-live="polite" hidden>
        <div class="big" id="probText">少なくとも1回発生する確率: -</div>
        <div id="detailText" class="muted">p = -, N = - ／ 期待回数 N×p = -</div>
        <div id="thresholdText" class="muted">50％超の最小N = -</div>
        <div id="oneMinusPText" class="muted">(1−p)％超の最小N = -</div>
      </div>
    </div>

    <p class="muted" style="margin-top:12px;">計算式: 1 - (1 - p)^N</p>
  </div>

  <script>
    function normalizeP(raw) {
      var s = String(raw || '').trim();
      if (!s) return { ok:false, msg:'pが入力されていません。' };
      // 分数形式（例: 1/100 や 3/10）
      var m = s.match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);
      if (m) {
        var num = Number(m[1]);
        var den = Number(m[2]);
        if (den === 0) return { ok:false, msg:'分母が0です。' };
        var vFrac = num / den;
        if (!isFinite(vFrac)) return { ok:false, msg:'pが数値ではありません。' };
        if (vFrac < 0 || vFrac > 1) return { ok:false, msg:'pは0〜1（0%〜100%）の範囲で入力してください。' };
        return { ok:true, value: vFrac };
      }
      // パーセント記号付き（例: "10%", "0.1%"）
      var mp = s.match(/^\s*([+-]?[0-9]*\.?[0-9]+)\s*%\s*$/);
      if (mp) {
        var vPercent = Number(mp[1]);
        if (!isFinite(vPercent)) return { ok:false, msg:'pが数値ではありません。' };
        var vFromPercent = vPercent / 100;
        if (vFromPercent < 0 || vFromPercent > 1) return { ok:false, msg:'pは0〜1（0%〜100%）の範囲で入力してください。' };
        return { ok:true, value: vFromPercent };
      }
      // 数値 or パーセント（例: 10 は 10%）
      var v = Number(s);
      if (!isFinite(v)) return { ok:false, msg:'pが数値ではありません。' };
      if (v > 1) v = v / 100;
      if (v < 0 || v > 1) return { ok:false, msg:'pは0〜1（0%〜100%）の範囲で入力してください。' };
      return { ok:true, value: v };
    }
    function normalizeN(raw) {
      var n = Number(raw);
      if (!Number.isFinite(n)) return { ok:false, msg:'Nが数値ではありません。' };
      if (!Number.isInteger(n) || n < 0) return { ok:false, msg:'Nは0以上の整数で入力してください。' };
      return { ok:true, value:n };
    }
    function fmtPercent(x) { return (x * 100).toFixed(4) + '%'; }
    function fmtExpect(n, p) { return (n * p).toFixed(4); }
    function minNOver50(p) {
      if (p <= 0) return null; // 0では到達しない
      if (p >= 1) return 1;    // 確率1ならN=1で到達
      var nReal = Math.log(0.5) / Math.log(1 - p);
      return Math.ceil(nReal);
    }
    function minNOverOneMinusP(p) {
      if (p <= 0) return null; // 100％超は到達不可
      if (p >= 1) return 1;    // 0％超ならN=1で到達
      var nReal = Math.log(p) / Math.log(1 - p); // (1-p)^N < p
      return Math.ceil(nReal);
    }

    function calc() {
      var pRaw = document.getElementById('pInput').value;
      var nRaw = document.getElementById('nInput').value;
      var errBox = document.getElementById('error');
      var resBox = document.getElementById('result');
      errBox.textContent = '';

      var p = normalizeP(pRaw);
      if (!p.ok) { errBox.textContent = p.msg; resBox.hidden = true; return; }
      var n = normalizeN(nRaw);
      if (!n.ok) { errBox.textContent = n.msg; resBox.hidden = true; return; }

      var probAtLeastOne = 1 - Math.pow(1 - p.value, n.value);
      document.getElementById('probText').textContent = '少なくとも1回発生する確率: ' + fmtPercent(probAtLeastOne);
      document.getElementById('detailText').textContent = 'p = ' + p.value + ', N = ' + n.value + ' ／ 期待回数 N×p = ' + fmtExpect(n.value, p.value);
      var m = minNOver50(p.value);
      document.getElementById('thresholdText').textContent = '50％超の最小N = ' + (m === null ? '存在しません' : m);
      var m2 = minNOverOneMinusP(p.value);
      var percentText = ((1 - p.value) * 100).toFixed(0) + '％超の最小N = ';
      document.getElementById('oneMinusPText').textContent = percentText + (m2 === null ? '存在しません' : m2);
      resBox.hidden = false;
    }

    function reset() {
      document.getElementById('pInput').value = '';
      document.getElementById('nInput').value = '';
      document.getElementById('error').textContent = '';
      document.getElementById('result').hidden = true;
    }

    document.getElementById('calcBtn').addEventListener('click', calc);
    document.getElementById('resetBtn').addEventListener('click', reset);
    document.getElementById('resetNBtn').addEventListener('click', function(){
      document.getElementById('nInput').value = '0';
      // pが有効ならそのまま再計算して結果を更新
      calc();
    });
    // Enterキーでも計算
    document.getElementById('pInput').addEventListener('keydown', function(e){ if (e.key === 'Enter') calc(); });
    // pの入力が変わるたび自動計算
    document.getElementById('pInput').addEventListener('input', function(){ calc(); });
    document.getElementById('nInput').addEventListener('keydown', function(e){ if (e.key === 'Enter') calc(); });
    // Nの入力が変わるたび自動計算
    document.getElementById('nInput').addEventListener('input', function(){ calc(); });
    // 大型スピンボタン（直接入力も維持）
    document.getElementById('nUp').addEventListener('click', function(){
      var nEl = document.getElementById('nInput');
      var n = Number(nEl.value || 0);
      if (!Number.isFinite(n) || n < 0) n = 0;
      nEl.value = String(n + 1);
      calc();
    });
    document.getElementById('nDown').addEventListener('click', function(){
      var nEl = document.getElementById('nInput');
      var n = Number(nEl.value || 0);
      if (!Number.isFinite(n) || n <= 0) { nEl.value = '0'; return; }
      nEl.value = String(n - 1);
      calc();
    });
  </script>
</body>
</html>